<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Formulario de Registro</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Bootstrap CSS v5.3.3 desde CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Icons CSS desde CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <header>
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand d-flex align-items-center" href="index.html">
            <i class="bi bi-house-door-fill"></i>
            <span class="ms-2">Brand</span>
          </a>

          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Inicio</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="registro.html">Registro</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Servicios</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Nosotros</a>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  >Recursos</a
                >
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <li><a class="dropdown-item" href="#">Documentación</a></li>
                  <li><a class="dropdown-item" href="#">Tutoriales</a></li>
                  <li><hr class="dropdown-divider" /></li>
                  <li><a class="dropdown-item" href="#">Soporte</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Contacto</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="mt-5 pt-5">
      <div class="container-md mb-5">
        <div class="card shadow-lg p-4">
          <h1
            class="p-3 mb-4 bg-success bg-gradient text-white shadow-sm text-center"
          >
            Formulario de Registro
          </h1>
          <form class="row g-3" id="registroForm">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="nombre"
                  placeholder="Nombre"
                  title="Ingresa tu nombre"
                />
                <label for="nombre">Nombre</label>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="apellidos"
                  placeholder="Apellidos"
                  title="Ingresa tus apellidos"
                />
                <label for="apellidos">Apellidos</label>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="Correo electrónico"
                  title="Ingresa tu correo"
                />
                <label for="email">Correo electrónico</label>
              </div>
            </div>

            <!-- Campo Tipo de usuario sin label -->
            <div class="col-12 col-md-6">
              <select
                id="tipoUsuario"
                class="form-control py-3"
                title="Ingresa tipo de usuario"
              >
                <option value="">Seleccione tipo de usuario</option>
                <option value="individual">Individual</option>
                <option value="empresa">Empresa</option>
                <option value="corporativo">Corporativo</option>
              </select>
            </div>

            <!-- Campo Comunidad Autónoma sin label -->
            <div class="col-12 col-md-6">
              <select
                id="comunidadAutonoma"
                class="form-control py-3"
                title="Ingresa tu Comunidad Autónoma"
              >
                <option value="">Seleccione Comunidad Autónoma</option>
                <option value="Andalucia">Andalucia</option>
                <option value="Catalunya">Catalunya</option>
                <option value="Madrid">Madrid</option>
                <option value="Galicia">Galicia</option>
                <option value="Extremadura">Extremadura</option>
              </select>
            </div>

            <!-- Campo Código de referido sin label -->
            <div class="col-12 col-md-6">
              <div class="input-group">
                <input
                  type="text"
                  id="codigoReferido"
                  class="form-control py-3"
                  placeholder="Código de referido"
                  title="Ingresa el código referido si tienes uno"
                />
                <button
                  type="button"
                  id="btnAplicarCodigo"
                  class="btn btn-light"
                >
                  Aplicar
                </button>
              </div>
            </div>

            <div class="col-12 col-md-4">
              <fieldset>
                <legend>Intereses</legend>
                <ul class="list-unstyled">
                  <li>
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="interesTecnologia"
                    />
                    <label for="interesTecnologia">Tecnología</label>
                  </li>
                  <li>
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="interesNegocios"
                    />
                    <label for="interesNegocios">Negocios</label>
                  </li>
                  <li>
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="interesDiseno"
                    />
                    <label for="interesDiseno">Diseño</label>
                  </li>
                </ul>
              </fieldset>
            </div>

            <div class="col-12 col-md-4">
              <fieldset>
                <legend>Plan de Suscripción</legend>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="plan"
                    id="planBasico"
                    value="basico"
                  />
                  <label class="form-check-label" for="planBasico">
                    Plan Básico
                    <i
                      class="bi bi-question-circle ms-2"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="Plan con funciones limitadas"
                    ></i>
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="plan"
                    id="planPremium"
                    value="premium"
                  />
                  <label class="form-check-label" for="planPremium">
                    Plan Premium
                    <i
                      class="bi bi-question-circle ms-2"
                      data-bs-toggle="tooltip"
                      data-bs-placement="top"
                      title="Plan con todas las funciones premium"
                    ></i>
                  </label>
                </div>
              </fieldset>
            </div>

            <div class="col-12 col-md-4 d-flex align-items-center">
              <label for="temaColor" class="me-2">Tema:</label>
              <input
                type="color"
                id="temaColor"
                class="form-control form-control-color me-2"
              />
              <span id="colorValor" class="fw-bold"><strong>#000000</strong></span>
            </div>

            <div class="col-12 text-center">
              <button type="submit" class="btn btn-primary btn-lg shadow-sm">
                Registrarse
              </button>
            </div>
            <div id="descuentoMensaje" class="mt-3"></div>
          </form>
        </div>
      </div>
    </main>
    <div
      id="toastContainer"
      class="position-fixed top-0 end-0 p-3"
      style="z-index: 9999"
    ></div>
    <div
      class="modal fade"
      id="modalResultado"
      tabindex="-1"
      aria-labelledby="modalResultadoLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalResultadoLabel">
              Resultado del Registro
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="modalResultadoMensaje"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success"
              data-bs-dismiss="modal"
            >
              Aceptar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap JavaScript Libraries desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery desde CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#temaColor").on("input", function () {
          var color = $(this).val();
          $("#colorValor").text(color).css("font-family", "monospace");
        });
        $("#temaColor").on("input", function () {
          var colorSeleccionado = $(this).val();
          $("#colorValor")
            .text(colorSeleccionado)
            .css("color", colorSeleccionado);
        });
        $.ajax({
          url: "/json/codigos.json",
          dataType: "json",
          success: function (codigosDescuento) {
            $("#btnAplicarCodigo").on("click", function () {
              var codigo = $("#codigoReferido").val();
              var codigoValido = codigosDescuento.find(function (item) {
                return item.codigo === codigo;
              });

              if (!codigoValido) {
                var toastError = $(
                  '<div class="toast align-items-center text-bg-danger border-0 my-2" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body p-3">Código de descuento no válido.</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div></div>'
                );
                $("#toastContainer").append(toastError);
                toastError.toast("show");
                $("#descuentoMensaje").empty();
              } else {
                var descuentoMensaje = `Tu descuento es: ${codigoValido.descuento}`;

                $("#descuentoMensaje")
                  .text(descuentoMensaje)
                  .addClass("alert alert-success rounded text-start");

                var toastSuccess = $(
                  `<div class="toast align-items-center text-bg-success border-0 my-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                  <div class="toast-body p-3">${descuentoMensaje}</div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
              </div>`
                );
                $("#toastContainer").append(toastSuccess);
                toastSuccess.toast("show");

                $("#btnAplicarCodigo").prop("disabled", true).text("Aplicado");
              }
            });
          },
          error: function () {
            alert("Error al cargar los códigos de descuento.");
          },
        });

        $("[title]").tooltip();

        $("#registroForm").on("submit", function (e) {
          e.preventDefault();
          var camposVacios = false;
          var toastMessages = [];

          $("input, select").each(function () {
            if ($(this).val() === "" && $(this).is(":visible")) {
              camposVacios = true;
              $(this).css("background-color", "#f8d7da");
            } else {
              $(this).css("background-color", "");
            }
          });

          if (
            !$("#interesTecnologia").prop("checked") &&
            !$("#interesNegocios").prop("checked") &&
            !$("#interesDiseno").prop("checked")
          ) {
            toastMessages.push("Por favor, seleccione al menos un interés.");
          }

          if (!$('input[name="plan"]:checked').val()) {
            toastMessages.push("Por favor, seleccione un plan de suscripción.");
          }

          if (camposVacios) {
            toastMessages.push(
              "Por favor, complete todos los campos obligatorios."
            );
          }

          if (toastMessages.length > 0) {
            toastMessages.forEach(function (msg) {
              var toastError = $(
                '<div class="toast align-items-center text-bg-danger border-0 my-2" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body p-3">' +
                  msg +
                  '</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div></div>'
              );
              $("#toastContainer").append(toastError);
              toastError.toast("show");
            });
            return;
          }

          $.ajax({
            url: "/json/registro.json",
            method: "GET",
            data: $("#registroForm"),
            success: function (response) {
              if (response.error === 0) {
                var modalMessage = `
            <div class="alert " role="alert">
            <p>El registro se ha realizado correctamente.</p>
            </div>
           `;
                $("#modalResultadoMensaje").html(modalMessage);
                $("#modalResultado").modal("show");
              } else {
                var modalMessageError = `
                <div class="alert" role="alert">
                <p>${response.error_msg}</p>
                </div>
                `;
                $("#modalResultadoMensaje").html(modalMessageError);
                $("#modalResultado").modal("show");
              }
            },
            error: function () {
              var modalMessageError = `
              <div class="alert alert-danger" role="alert">
              <h4 class="alert-heading">Error al procesar el registro</h4>
              <p>Hubo un problema al intentar registrar tus datos.</p>
              </div>
              `;
              $("#modalResultadoMensaje").html(modalMessageError);
              $("#modalResultado").modal("show");
            },
          });
        });
      });
    </script>
  </body>
</html>
